# 电子烟页面功能说明

## 优化概述

对电子烟页面进行了全面优化，实现了更真实的吸烟体验和更直观的交互设计。

## 核心改进

### 1. 香烟横向显示

**改进前：**
- 香烟竖向显示
- 视觉效果不够真实

**改进后：**
- ✅ 香烟横向放置，更符合真实吸烟场景
- ✅ 增加香烟粗度（24px），视觉效果更好
- ✅ 明确的过滤嘴设计（橙黄色，带纹理）
- ✅ Canvas尺寸调整为 600rpx × 300rpx

### 2. 燃烧效果

**核心机制：**
- 吸6口完全燃烧（燃烧到过滤嘴位置）
- 每吸一口燃烧进度增加约16.67%
- 燃烧进度：0% → 16.67% → 33.33% → 50% → 66.67% → 83.33% → 100%

**视觉效果：**
- 🔴 **燃烧点**：红色发光效果，模拟真实燃烧
- ⚪ **未燃烧部分**：白色烟身
- ⚫ **已燃烧部分**：灰色烟灰
- 🟠 **过滤嘴**：橙黄色，带竖条纹理

### 3. 抖烟灰功能

**功能逻辑：**
- 点击"抖灰"按钮，移除所有烟灰
- 只剩下过滤嘴（橙黄色部分）
- 燃烧进度直接设置为100%

**使用场景：**
```
吸了3口 → 燃烧50% → 点击抖灰 → 只剩过滤嘴
```

### 4. 按钮纵向排列

**改进前：**
- 按钮横向两列排列
- 图标和文字纵向排列

**改进后：**
- ✅ 按钮纵向单列排列
- ✅ 图标和文字横向排列
- ✅ 按钮更大（100rpx高度）
- ✅ 更易于点击操作

## 详细功能说明

### 功能1：点火 🔥

**操作：**
- 点击"点火"按钮
- 或摇一摇手机（未点火状态）

**效果：**
- 香烟燃烧点变红并发光
- 显示"点火成功"提示
- 播放点火音效

**状态变化：**
```
isLit: false → true
```

### 功能2：吸一口 💨

**操作：**
- 点击"吸一口"按钮

**前置条件：**
- 必须先点火
- 燃烧进度 < 100%

**效果：**
- 燃烧进度增加约16.67%
- 烟灰部分增长
- 产生烟雾粒子动画
- 播放吸烟音效
- 统计次数 +1

**状态变化：**
```
currentPuffs: +1
burnProgress: +16.67%
```

**特殊提示：**
- 吸6口后提示"抽完了，换一根吧"
- 燃烧到过滤嘴位置

### 功能3：抖灰 🌪️

**操作：**
- 点击"抖灰"按钮
- 或摇一摇手机（已点火状态）

**前置条件：**
- 必须先点火
- 燃烧进度 > 0%

**效果：**
- 移除所有烟灰
- 只剩过滤嘴
- 显示"抖灰成功，只剩过滤嘴了"
- 播放抖灰音效
- 统计次数 +1

**状态变化：**
```
burnProgress: → 100%
currentPuffs: → 6
```

### 功能4：再来一根 🚬

**操作：**
- 点击"再来一根"按钮

**效果：**
- 重置所有状态
- 渲染全新香烟
- 显示"换了一根新烟"
- 统计次数 +1

**状态变化：**
```
isLit: → false
burnProgress: → 0%
currentPuffs: → 0
particles: → []
```

### 功能5：送烟给好友 🎁

**操作：**
- 点击"送烟给好友"按钮

**效果：**
- 触发微信分享
- 好友可以收到电子烟

## 视觉设计

### 香烟结构

```
┌─────────────────────────────────────────┐
│  烟灰  │  白色烟身  │  过滤嘴  │
│ (灰色) │  (白色)   │ (橙黄色) │
│        │           │  ||||    │
└─────────────────────────────────────────┘
   ↑燃烧点(红色发光)
```

### 燃烧进度示意

**0% - 未点火：**
```
[          白色烟身          ][过滤嘴]
```

**50% - 吸了3口：**
```
[烟灰][  白色烟身  ][过滤嘴]
      ↑燃烧点
```

**100% - 抽完或抖灰后：**
```
[        烟灰        ][过滤嘴]
                      ↑燃烧到过滤嘴
```

## 交互流程

### 完整吸烟流程

```
1. 点击"点火" 🔥
   ↓
2. 点击"吸一口" 💨 (第1口，燃烧16.67%)
   ↓
3. 点击"吸一口" 💨 (第2口，燃烧33.33%)
   ↓
4. 点击"吸一口" 💨 (第3口，燃烧50%)
   ↓
5. 点击"吸一口" 💨 (第4口，燃烧66.67%)
   ↓
6. 点击"吸一口" 💨 (第5口，燃烧83.33%)
   ↓
7. 点击"吸一口" 💨 (第6口，燃烧100%)
   ↓
8. 提示"抽完了，换一根吧"
   ↓
9. 点击"再来一根" 🚬
   ↓
10. 重新开始
```

### 抖灰流程

```
1. 点击"点火" 🔥
   ↓
2. 点击"吸一口" 💨 (吸几口)
   ↓
3. 点击"抖灰" 🌪️
   ↓
4. 烟灰被移除，只剩过滤嘴
   ↓
5. 点击"再来一根" 🚬
   ↓
6. 重新开始
```

## 数据统计

页面底部显示今日统计：

| 统计项 | 说明 |
|-------|------|
| **吸了几口** | 今日总共吸烟次数 |
| **抖了几次** | 今日总共抖灰次数 |
| **再来几根** | 今日总共换烟次数 |

## 技术实现

### Canvas绘制

**尺寸：**
- 宽度：600rpx (300px)
- 高度：300rpx (150px)

**香烟参数：**
```javascript
cigaretteLength: 280px   // 香烟总长度
cigaretteWidth: 24px     // 香烟粗度
filterLength: 40px       // 过滤嘴长度
burnableLength: 240px    // 可燃烧长度
```

**绘制顺序：**
1. 清空画布
2. 绘制未燃烧的烟身（白色）
3. 绘制过滤嘴（橙黄色 + 纹理）
4. 绘制已燃烧的烟灰（灰色）
5. 绘制燃烧点（红色发光）
6. 绘制烟雾粒子

### 燃烧计算

```javascript
// 计算燃烧长度
burnableLength = cigaretteLength - filterLength  // 240px
burnedLength = (burnProgress / 100) * burnableLength

// 每吸一口的进度
progressPerPuff = 100 / maxPuffs  // 16.67%
```

### 状态管理

```javascript
data: {
  isLit: false,          // 是否已点火
  burnProgress: 0,       // 燃烧进度 (0-100)
  maxPuffs: 6,           // 最多吸几口
  currentPuffs: 0,       // 当前已吸几口
  particles: [],         // 烟雾粒子
  puffCount: 0,          // 今日吸烟次数
  shakeCount: 0,         // 今日抖灰次数
  newCount: 0            // 今日换烟次数
}
```

## 用户体验优化

### 1. 视觉反馈

- ✅ 燃烧点红色发光效果
- ✅ 烟雾粒子动画
- ✅ 按钮按下缩放效果
- ✅ 渐变色按钮设计

### 2. 操作提示

- ✅ 未点火时吸烟提示"请先点火"
- ✅ 抽完时提示"已经抽完了，换一根吧"
- ✅ 无烟灰时抖灰提示"还没有烟灰"
- ✅ 操作成功的Toast提示

### 3. 交互优化

- ✅ 按钮纵向排列，更易点击
- ✅ 支持摇一摇手机操作
- ✅ 音效反馈（点火、吸烟、抖灰）
- ✅ 实时统计数据显示

### 4. 真实感

- ✅ 香烟横向放置
- ✅ 明确的过滤嘴设计
- ✅ 逐步燃烧效果
- ✅ 烟灰颜色区分

## 使用建议

### 正常使用流程

1. **点火** → 2. **吸6口** → 3. **换新烟** → 重复

### 快速抖灰流程

1. **点火** → 2. **吸几口** → 3. **抖灰** → 4. **换新烟** → 重复

### 摇一摇操作

- 未点火时摇手机 = 点火
- 已点火时摇手机 = 抖灰

## 注意事项

1. **Canvas初始化**
   - 页面加载时自动初始化Canvas
   - 如果Canvas未显示，检查Canvas节点是否正确

2. **音效播放**
   - 需要在 `/assets/audios/` 目录下放置音效文件
   - 文件名：`light.mp3`, `puff.mp3`, `shake.mp3`

3. **加速度传感器**
   - 摇一摇功能需要用户授权
   - 真机测试时才能正常使用

4. **数据统计**
   - 统计数据保存在云端
   - 每日0点重置统计

## 后续优化建议

1. **视觉效果**
   - 添加烟灰掉落动画
   - 优化烟雾粒子效果
   - 添加燃烧闪烁效果

2. **交互功能**
   - 支持长按快速吸烟
   - 添加吸烟声音效果
   - 支持自定义香烟品牌

3. **社交功能**
   - 好友送烟记录
   - 吸烟排行榜
   - 成就勋章系统

4. **数据分析**
   - 每周吸烟统计
   - 吸烟习惯分析
   - 戒烟进度对比

## 总结

这次优化实现了：

✅ **横向香烟显示**，更真实的视觉效果
✅ **增加香烟粗度**，视觉更清晰
✅ **明确的过滤嘴设计**，带纹理效果
✅ **逐步燃烧效果**，吸6口燃烧完
✅ **抖烟灰功能**，只剩过滤嘴
✅ **按钮纵向排列**，操作更便捷
✅ **再来一根功能**，重新渲染全新香烟

电子烟页面现在提供了更真实、更有趣的吸烟体验，帮助用户在戒烟过程中缓解烟瘾！
