<!--pages/index/index.wxml-->
<view class="container">
  <!-- æˆ’çƒŸå¤©æ•°å±•ç¤ºåŒº -->
  <view class="quit-days-section">
    <view class="quit-icon">ğŸš­</view>
    <view class="quit-title">æˆ‘å·²æˆ’çƒŸ</view>
    <view class="quit-days-wrapper">
      <text class="quit-days-number">{{ quitDays }}</text>
      <text class="quit-days-unit">å¤©</text>
    </view>
    <view class="quit-subtitle" wx:if="{{ quitDays > 0 }}">
      è·ç¦»ç›®æ ‡è¿˜æœ‰ {{ targetDays }} å¤©
    </view>
    <view class="quit-subtitle" wx:else>
      <text class="text-tertiary">ç‚¹å‡»ä¸‹æ–¹è®¾ç½®å¼€å§‹æˆ’çƒŸæ—¥æœŸ</text>
    </view>
  </view>

  <!-- ç­¾åˆ°åŒºåŸŸ -->
  <view class="checkin-section card">
    <view class="checkin-header flex-between">
      <view class="checkin-info">
        <text class="checkin-label">è¿ç»­ç­¾åˆ°</text>
        <text class="checkin-days">{{ currentStreak }}å¤©</text>
      </view>
      <view class="checkin-info">
        <text class="checkin-label">ç´¯è®¡ç­¾åˆ°</text>
        <text class="checkin-days">{{ totalCheckin }}å¤©</text>
      </view>
    </view>
    
    <view class="checkin-button-wrapper">
      <button 
        class="checkin-button {{ hasCheckedToday ? 'checked' : '' }}" 
        bindtap="handleCheckin"
        disabled="{{ hasCheckedToday }}"
      >
        <text class="checkin-button-icon">{{ hasCheckedToday ? 'âœ“' : 'ğŸ“' }}</text>
        <text class="checkin-button-text">{{ hasCheckedToday ? 'ä»Šæ—¥å·²ç­¾åˆ°' : 'ç‚¹å‡»ç­¾åˆ°' }}</text>
      </button>
    </view>

    <view class="checkin-footer">
      <text class="checkin-tip" bindtap="goToCalendar">æŸ¥çœ‹ç­¾åˆ°æ—¥å† ></text>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-entry-section">
    <view class="section-title">å¿«æ·å…¥å£</view>
    <view class="quick-entry-grid">
      <view class="quick-entry-item" bindtap="goToCigarette">
        <view class="quick-entry-icon">ğŸš¬</view>
        <text class="quick-entry-name">ç”µå­çƒŸ</text>
      </view>
      <view class="quick-entry-item" bindtap="goToRefuse">
        <view class="quick-entry-icon">ğŸ›¡ï¸</view>
        <text class="quick-entry-name">æ‹’çƒŸç¥å™¨</text>
      </view>
      <view class="quick-entry-item" bindtap="goToCertificate">
        <view class="quick-entry-icon">ğŸ†</view>
        <text class="quick-entry-name">è£èª‰è¯ä¹¦</text>
      </view>
      <view class="quick-entry-item" bindtap="goToMethods">
        <view class="quick-entry-icon">ğŸ“š</view>
        <text class="quick-entry-name">æˆ’çƒŸæ–¹æ³•</text>
      </view>
    </view>
  </view>

  <!-- å¥åº·æ”¶ç›Šç»Ÿè®¡ -->
  <view class="health-stats-section card">
    <view class="section-title">å¥åº·æ”¶ç›Š</view>
    <view class="health-stats-grid">
      <view class="health-stat-item">
        <view class="health-stat-icon">ğŸ’°</view>
        <view class="health-stat-value">Â¥{{ savedMoney }}</view>
        <view class="health-stat-label">èŠ‚çœé‡‘é¢</view>
      </view>
      <view class="health-stat-item">
        <view class="health-stat-icon">ğŸš¬</view>
        <view class="health-stat-value">{{ savedCigarettes }}</view>
        <view class="health-stat-label">å°‘æŠ½é¦™çƒŸ</view>
      </view>
      <view class="health-stat-item">
        <view class="health-stat-icon">â¤ï¸</view>
        <view class="health-stat-value">{{ healthIndex }}%</view>
        <view class="health-stat-label">å¥åº·æŒ‡æ•°</view>
      </view>
    </view>
    <view class="health-tip">
      <text class="text-sm text-secondary">åšæŒæˆ’çƒŸï¼Œå¥åº·ç”Ÿæ´»æ¯ä¸€å¤©</text>
    </view>
  </view>

  <!-- æˆ’çƒŸæ–¹æ³•æ¨è -->
  <view class="methods-section" wx:if="{{ recommendArticles.length > 0 }}">
    <view class="section-title flex-between">
      <text>æˆ’çƒŸæ–¹æ³•æ¨è</text>
      <text class="more-link" bindtap="goToMethods">æ›´å¤š ></text>
    </view>
    <view class="article-list">
      <view 
        class="article-item card" 
        wx:for="{{ recommendArticles }}" 
        wx:key="id"
        bindtap="goToArticle"
        data-id="{{ item.id }}"
      >
        <view class="article-title text-ellipsis">{{ item.title }}</view>
        <view class="article-meta">
          <text class="article-tag">{{ item.category }}</text>
          <text class="article-views">ğŸ‘ï¸ {{ item.viewCount }}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Bannerå¹¿å‘Š -->
  <view class="ad-section">
    <ad unit-id="adunit-xxxxxxxxxxxxxxxx" ad-type="banner" ad-theme="white"></ad>
  </view>
</view>

<!-- è®¾ç½®æˆ’çƒŸæ—¥æœŸå¼¹çª— -->
<view class="modal-mask" wx:if="{{ showDatePicker }}" bindtap="closeDatePicker">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">è®¾ç½®å¼€å§‹æˆ’çƒŸæ—¥æœŸ</text>
    </view>
    <view class="modal-body">
      <picker 
        mode="date" 
        value="{{ quitDate }}" 
        end="{{ today }}"
        bindchange="onDateChange"
      >
        <view class="date-picker">
          <text>{{ quitDate || 'è¯·é€‰æ‹©æ—¥æœŸ' }}</text>
        </view>
      </picker>
    </view>
    <view class="modal-footer">
      <button class="modal-button cancel" bindtap="closeDatePicker">å–æ¶ˆ</button>
      <button class="modal-button confirm" bindtap="confirmQuitDate">ç¡®å®š</button>
    </view>
  </view>
</view>
