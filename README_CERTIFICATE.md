# è£èª‰è¯ä¹¦åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

è£èª‰è¯ä¹¦åŠŸèƒ½æ ¹æ®ç”¨æˆ·çš„æˆ’çƒŸå¤©æ•°ï¼Œç”Ÿæˆä¸åŒç­‰çº§çš„ä¸“å±è¯ä¹¦ã€‚è¯ä¹¦æ”¯æŒä¿å­˜åˆ°ç›¸å†Œå’Œåˆ†äº«ç»™å¥½å‹ã€‚

## è¯ä¹¦ç­‰çº§

æ ¹æ®æˆ’çƒŸå¤©æ•°ï¼Œè¯ä¹¦åˆ†ä¸º5ä¸ªç­‰çº§ï¼Œæ¯ä¸ªç­‰çº§æœ‰ç‹¬ç‰¹çš„è¾¹æ¡†æ ·å¼ï¼š

### 1. åˆçº§è¯ä¹¦ ğŸŒ±
- **è§£é”æ¡ä»¶**ï¼šæˆ’çƒŸæ»¡ 7 å¤©
- **è¾¹æ¡†æ ·å¼**ï¼šç®€å•å•çº¿è¾¹æ¡†
- **é¢œè‰²ä¸»é¢˜**ï¼šè“è‰² (#4A90E2)

### 2. ä¸­çº§è¯ä¹¦ ğŸŒ³
- **è§£é”æ¡ä»¶**ï¼šæˆ’çƒŸæ»¡ 30 å¤©
- **è¾¹æ¡†æ ·å¼**ï¼šåŒçº¿è¾¹æ¡†
- **é¢œè‰²ä¸»é¢˜**ï¼šç»¿è‰² (#50C878)

### 3. é«˜çº§è¯ä¹¦ ğŸ›¡ï¸
- **è§£é”æ¡ä»¶**ï¼šæˆ’çƒŸæ»¡ 90 å¤©
- **è¾¹æ¡†æ ·å¼**ï¼šè£…é¥°æ€§è¾¹æ¡†ï¼Œå››è§’å¸¦åœ†ç‚¹è£…é¥°
- **é¢œè‰²ä¸»é¢˜**ï¼šç´«è‰² (#9B59B6)

### 4. ä¸“å®¶è¯ä¹¦ ğŸ†
- **è§£é”æ¡ä»¶**ï¼šæˆ’çƒŸæ»¡ 180 å¤©
- **è¾¹æ¡†æ ·å¼**ï¼šåä¸½å¤šå±‚è¾¹æ¡†ï¼Œå¸¦è™šçº¿è£…é¥°
- **é¢œè‰²ä¸»é¢˜**ï¼šé‡‘è‰² (#F39C12)

### 5. å¤§å¸ˆè¯ä¹¦ ğŸ‘‘
- **è§£é”æ¡ä»¶**ï¼šæˆ’çƒŸæ»¡ 365 å¤©
- **è¾¹æ¡†æ ·å¼**ï¼šå½©è™¹æ¸å˜å¤šå±‚è¾¹æ¡†ï¼Œäº”è§’æ˜Ÿè£…é¥°
- **é¢œè‰²ä¸»é¢˜**ï¼šå½©è™¹æ¸å˜ï¼ˆçº¢ã€é»„ã€ç»¿ã€è“ã€ç´«ï¼‰

## åŠŸèƒ½ç‰¹æ€§

### 1. è¯ä¹¦ç”Ÿæˆ
- ä½¿ç”¨ Canvas 2D API ç»˜åˆ¶è¯ä¹¦
- æ ¹æ®ç­‰çº§è‡ªåŠ¨åº”ç”¨ä¸åŒçš„è¾¹æ¡†æ ·å¼
- åŒ…å«ç”¨æˆ·ä¿¡æ¯ã€æˆ’çƒŸå¤©æ•°ã€è·å¾—æ—¥æœŸç­‰
- é«˜æ¸…è¾“å‡ºï¼ˆ2å€åˆ†è¾¨ç‡ï¼‰

### 2. ä¿å­˜åˆ°ç›¸å†Œ
- ä¸€é”®ä¿å­˜è¯ä¹¦å›¾ç‰‡åˆ°æ‰‹æœºç›¸å†Œ
- è‡ªåŠ¨è¯·æ±‚ç›¸å†Œæƒé™
- æƒé™è¢«æ‹’åå¼•å¯¼ç”¨æˆ·åˆ°è®¾ç½®é¡µé¢

### 3. åˆ†äº«åŠŸèƒ½
- æ”¯æŒåˆ†äº«è¯ä¹¦åˆ°å¾®ä¿¡å¥½å‹/ç¾¤èŠ
- åˆ†äº«å¡ç‰‡æ˜¾ç¤ºè¯ä¹¦å›¾ç‰‡
- è‡ªå®šä¹‰åˆ†äº«æ ‡é¢˜å’Œè·¯å¾„

## è¾¹æ¡†æ ·å¼å®ç°

### åˆçº§è¯ä¹¦ï¼ˆBeginnerï¼‰
```javascript
// ç®€å•å•çº¿è¾¹æ¡†
ctx.strokeStyle = config.bgGradient[0];
ctx.lineWidth = 3;
drawRoundRect(ctx, 30, 50, width - 60, height - 100, 12);
ctx.stroke();
```

### ä¸­çº§è¯ä¹¦ï¼ˆIntermediateï¼‰
```javascript
// åŒçº¿è¾¹æ¡†
ctx.strokeStyle = config.bgGradient[0];
ctx.lineWidth = 3;
drawRoundRect(ctx, 30, 50, width - 60, height - 100, 12);
ctx.stroke();
ctx.lineWidth = 2;
drawRoundRect(ctx, 36, 56, width - 72, height - 112, 10);
ctx.stroke();
```

### é«˜çº§è¯ä¹¦ï¼ˆAdvancedï¼‰
```javascript
// è£…é¥°æ€§è¾¹æ¡† + å››è§’åœ†ç‚¹
ctx.strokeStyle = config.bgGradient[0];
ctx.lineWidth = 4;
drawRoundRect(ctx, 30, 50, width - 60, height - 100, 12);
ctx.stroke();

// å››è§’è£…é¥°
const corners = [[30, 50], [width - 30, 50], ...];
corners.forEach(([x, y]) => {
  ctx.beginPath();
  ctx.arc(x, y, 6, 0, Math.PI * 2);
  ctx.fill();
});
```

### ä¸“å®¶è¯ä¹¦ï¼ˆExpertï¼‰
```javascript
// å¤šå±‚è¾¹æ¡† + è™šçº¿è£…é¥°
// å¤–å±‚è¾¹æ¡†
ctx.strokeStyle = config.bgGradient[0];
ctx.lineWidth = 5;
drawRoundRect(ctx, 28, 48, width - 56, height - 96, 14);
ctx.stroke();

// å†…å±‚è¾¹æ¡†
ctx.strokeStyle = config.bgGradient[1];
ctx.lineWidth = 2;
drawRoundRect(ctx, 38, 58, width - 76, height - 116, 10);
ctx.stroke();

// è™šçº¿è£…é¥°
ctx.setLineDash([5, 5]);
drawRoundRect(ctx, 33, 53, width - 66, height - 106, 12);
ctx.stroke();
```

### å¤§å¸ˆè¯ä¹¦ï¼ˆMasterï¼‰
```javascript
// å½©è™¹æ¸å˜å¤šå±‚è¾¹æ¡†
const colors = config.bgGradient; // 5ç§é¢œè‰²
for (let i = 0; i < 5; i++) {
  ctx.strokeStyle = colors[i % colors.length];
  ctx.lineWidth = 3;
  const offset = 28 + i * 3;
  drawRoundRect(ctx, offset, 48 + i * 3, width - offset * 2, height - 96 - i * 6, 14 - i);
  ctx.stroke();
}

// äº”è§’æ˜Ÿè£…é¥°
const stars = [[width / 2, 40], [50, 80], ...];
stars.forEach(([x, y]) => {
  drawStar(ctx, x, y, 8, 5);
});
```

## ä½¿ç”¨æµç¨‹

### 1. è¿›å…¥è¯ä¹¦é¡µé¢
```javascript
wx.navigateTo({
  url: '/pages/certificate/certificate'
});
```

### 2. ç”Ÿæˆè¯ä¹¦
```javascript
// ç‚¹å‡»"ç”Ÿæˆè¯ä¹¦"æŒ‰é’®
handleGenerate() {
  // 1. ç»˜åˆ¶è¯ä¹¦åˆ°Canvas
  await this.drawCertificate();
  
  // 2. è½¬æ¢ä¸ºä¸´æ—¶å›¾ç‰‡
  const tempFilePath = await canvasToTempFilePath(this.canvas, {
    destWidth: this.canvasWidth * 2,
    destHeight: this.canvasHeight * 2,
    fileType: 'png',
    quality: 1
  });
  
  // 3. è°ƒç”¨äº‘å‡½æ•°è®°å½•
  await certificateService.generateCertificate(quitDays);
}
```

### 3. ä¿å­˜åˆ°ç›¸å†Œ
```javascript
handleSave() {
  // è°ƒç”¨å¾®ä¿¡APIä¿å­˜å›¾ç‰‡
  await wx.saveImageToPhotosAlbum({
    filePath: this.data.tempFilePath
  });
}
```

### 4. åˆ†äº«è¯ä¹¦
```javascript
onShareAppMessage() {
  return {
    title: `æˆ‘å·²æˆåŠŸæˆ’çƒŸ${quitDays}å¤©ï¼Œè·å¾—${certificateLevel}ï¼`,
    path: '/pages/index/index',
    imageUrl: this.data.tempFilePath
  };
}
```

## æ•°æ®åº“ç»“æ„

### certificates é›†åˆ
```javascript
{
  _id: "è¯ä¹¦ID",
  _openid: "ç”¨æˆ·openid",
  level: "è¯ä¹¦ç­‰çº§(beginner/intermediate/advanced/expert/master)",
  quitDays: æˆ’çƒŸå¤©æ•°,
  createTime: "åˆ›å»ºæ—¶é—´"
}
```

## äº‘å‡½æ•°

### generateCertificate
- **åŠŸèƒ½**ï¼šç”Ÿæˆè¯ä¹¦è®°å½•
- **å‚æ•°**ï¼š`{ quitDays: Number }`
- **è¿”å›**ï¼š`{ success: Boolean, certificate: Object }`
- **é€»è¾‘**ï¼š
  1. æ ¹æ®æˆ’çƒŸå¤©æ•°è®¡ç®—è¯ä¹¦ç­‰çº§
  2. æ£€æŸ¥æ˜¯å¦å·²ç”Ÿæˆè¯¥ç­‰çº§è¯ä¹¦
  3. åˆ›å»ºè¯ä¹¦è®°å½•åˆ°æ•°æ®åº“

## æ³¨æ„äº‹é¡¹

1. **æƒé™ç”³è¯·**ï¼šé¦–æ¬¡ä¿å­˜åˆ°ç›¸å†Œéœ€è¦ç”¨æˆ·æˆæƒ
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šCanvasç»˜åˆ¶é‡‡ç”¨2å€åˆ†è¾¨ç‡ï¼Œç¡®ä¿å›¾ç‰‡æ¸…æ™°
3. **é˜²é‡å¤ç”Ÿæˆ**ï¼šåŒä¸€ç­‰çº§è¯ä¹¦åªè®°å½•ä¸€æ¬¡
4. **åˆ†äº«é™åˆ¶**ï¼šå¿…é¡»å…ˆç”Ÿæˆè¯ä¹¦æ‰èƒ½åˆ†äº«
5. **ç­‰çº§è§£é”**ï¼šé¡µé¢æ˜¾ç¤ºæ‰€æœ‰ç­‰çº§ï¼Œæœªè¾¾åˆ°çš„æ˜¾ç¤ºä¸º"æœªè§£é”"

## æ–‡ä»¶ç»“æ„

```
miniprogram/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ certificate/
â”‚       â”œâ”€â”€ certificate.js       # é¡µé¢é€»è¾‘
â”‚       â”œâ”€â”€ certificate.wxml     # é¡µé¢ç»“æ„
â”‚       â”œâ”€â”€ certificate.wxss     # é¡µé¢æ ·å¼
â”‚       â””â”€â”€ certificate.json     # é¡µé¢é…ç½®
â”œâ”€â”€ services/
â”‚   â””â”€â”€ certificate.js           # è¯ä¹¦æœåŠ¡
â””â”€â”€ utils/
    â””â”€â”€ canvas.js                # Canvaså·¥å…·å‡½æ•°

cloudfunctions/
â””â”€â”€ generateCertificate/
    â”œâ”€â”€ index.js                 # äº‘å‡½æ•°å…¥å£
    â”œâ”€â”€ config.json              # äº‘å‡½æ•°é…ç½®
    â””â”€â”€ package.json             # ä¾èµ–é…ç½®
```

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. âœ¨ æ·»åŠ æ›´å¤šè¯ä¹¦æ¨¡æ¿æ ·å¼
2. ğŸ¨ æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰è¯ä¹¦èƒŒæ™¯
3. ğŸ“Š æ·»åŠ è¯ä¹¦åˆ†äº«ç»Ÿè®¡
4. ğŸ… æ·»åŠ ç‰¹æ®Šæˆå°±è¯ä¹¦ï¼ˆå¦‚è¿ç»­ç­¾åˆ°ã€é›¶å¤å¸ç­‰ï¼‰
5. ğŸ’¾ æ”¯æŒè¯ä¹¦å†å²è®°å½•æŸ¥çœ‹
6. ğŸ–¼ï¸ æ”¯æŒè¯ä¹¦é¢„è§ˆæ”¾å¤§æŸ¥çœ‹
7. ğŸ è¯ä¹¦è§£é”å¥–åŠ±ï¼ˆå¦‚ç§¯åˆ†ã€å‹‹ç« ç­‰ï¼‰

## æŠ€æœ¯è¦ç‚¹

- **Canvas 2D API**ï¼šä½¿ç”¨æ–°ç‰ˆCanvas APIï¼Œæ€§èƒ½æ›´å¥½
- **æ¸å˜ç»˜åˆ¶**ï¼šæ”¯æŒçº¿æ€§å’Œå¾„å‘æ¸å˜èƒŒæ™¯
- **åœ†è§’çŸ©å½¢**ï¼šè‡ªå®šä¹‰åœ†è§’çŸ©å½¢ç»˜åˆ¶å‡½æ•°
- **æ–‡å­—å±…ä¸­**ï¼šè‡ªåŠ¨è®¡ç®—æ–‡å­—ä½ç½®å®ç°å±…ä¸­
- **å›¾ç‰‡å¯¼å‡º**ï¼šé«˜æ¸…å›¾ç‰‡å¯¼å‡ºï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†è¾¨ç‡
- **æƒé™å¤„ç†**ï¼šä¼˜é›…å¤„ç†ç›¸å†Œæƒé™æˆæƒæµç¨‹
